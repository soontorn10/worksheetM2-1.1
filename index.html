<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÉ‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô</title> 
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #F8F4FF; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô */ } 
        .page { display: none; }
        .page.active { display: block; }
        textarea { min-height: 250px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */ }
        .dashboard-card { background-color: white; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); border: 1px solid #E2E8F0; }
        
        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î */
        .ready-for-capture { width: 1000px !important; padding: 40px !important; box-shadow: none !important; background-color: white !important; }
        .ready-for-capture .dashboard-grid { grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
        .ready-for-capture .dashboard-full-span { grid-column: 1 / -1 !important; }
        .ready-for-capture .analysis-box { column-count: 1 !important; } /* ‡πÑ‡∏°‡πà‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• */
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; pointer-events: none; }
    </style>
</head>
<body class="p-4 md:p-8">
    <canvas id="confetti-canvas"></canvas>
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-6 bg-white p-3 rounded-2xl shadow-lg">
            <div id="step-1-indicator" class="step-indicator flex-1 text-center p-3 rounded-xl">
                <span class="font-bold text-sm md:text-base">1. üßë‚Äçüè´ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
            </div>
            <div class="text-gray-300 mx-2">‚Üí</div>
            <div id="step-2-indicator" class="step-indicator flex-1 text-center p-3 rounded-xl">
                <span class="font-bold text-sm md:text-base">2. ‚úçÔ∏è ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏¥‡∏™‡∏£‡∏∞</span>
            </div>
            <div class="text-gray-300 mx-2">‚Üí</div>
            <div id="step-3-indicator" class="step-1 flex-1 text-center p-3 rounded-xl">
                <span class="font-bold text-sm md:text-base">3. üì• ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô</span>
            </div>
        </div>

        <div id="page-1" class="page dashboard-card active">
             <h1 class="text-3xl font-bold text-purple-600 mb-2">‡πÉ‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h1>
            <p class="text-xl text-gray-600 mb-6">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô üåç (‡∏® ‡πì.‡πë ‡∏°.‡πí/‡πï)</p>
            <p class="text-lg text-gray-500 mb-8">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏∞</p>
            
            <form id="info-form" class="space-y-4">
                <div><label for="student-name" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-red-500">*</span></label><input type="text" id="student-name" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500" required></div>
                <div><label for="student-class" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏±‡πâ‡∏ô <span class="text-red-500">*</span></label><input type="text" id="student-class" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500" required></div>
                <div><label for="student-number" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <span class="text-red-500">*</span></label><input type="number" id="student-number" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500" required></div>
                
                <button id="btn-to-page-2" type="submit" class="w-full bg-purple-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-purple-600 transition duration-300 text-lg">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°Ô∏è</button>
            </form>
        </div>

        <div id="page-2" class="page dashboard-card">
            <form id="worksheet-form" class="space-y-8">
                
                <div>
                    <h1 class="text-3xl font-bold text-purple-600 mb-2">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏•‡∏Å</h1>
                    <p class="text-lg text-gray-600 mb-6">‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á: ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡πë ‡∏ß‡∏¥‡∏ä‡∏≤** ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡πà‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£</p>
                    
                    <div class="mb-6">
                        <label for="student-subject" class="block text-xl font-semibold text-red-600 mb-2">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î <span class="text-red-500">*</span></label>
                        <input type="text" id="student-subject" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 bg-red-50" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå, ‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤, ‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô, ‡∏Ø‡∏•‡∏Ø)" required>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <label for="ans-analysis" class="block text-xl font-semibold text-gray-800 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡πÇ‡∏õ‡∏£‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span class="text-red-500">*</span></label>
                            <textarea id="ans-analysis" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500" placeholder="‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡πà‡∏≤‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡πÇ‡∏õ‡∏£‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏°‡∏¥‡∏ï‡∏¥‡πÉ‡∏î‡∏ö‡πâ‡∏≤‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤, ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£, ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå, ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö... (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)" required></textarea>
                        </div>
                    </div>
                </div>

                <button id="btn-to-page-3" type="submit" class="w-full bg-green-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-green-600 transition duration-300 text-lg">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• üì§</button>
            </form>
        </div>

        <div id="page-3" class="page">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-purple-600">‚ú® ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h1>
                <p class="text-lg text-gray-500">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô</p>
            </div>
            
            <div id="summary-content" class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-center text-purple-600 mb-2">‡πÉ‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
                    <p class="text-lg text-center text-gray-600">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 dashboard-grid">
                    <div class="dashboard-card h-full border-l-4 border-purple-500 md:col-span-2 dashboard-full-span"> 
                        <h3 class="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
                        <div class="space-y-3 text-lg grid grid-cols-2 gap-4">
                            <div><span class="text-gray-500 block text-sm">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span><span id="summary-name" class="font-semibold text-gray-900"></span></div>
                            <div><span class="text-gray-500 block text-sm">‡∏ä‡∏±‡πâ‡∏ô / ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</span><span id="summary-class-num" class="font-semibold text-gray-900"></span></div>
                            <div class="md:col-span-2"><span class="text-gray-500 block text-sm">‡∏ß‡∏¥‡∏ä‡∏≤‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span><span id="summary-subject" class="font-bold text-red-600 text-xl"></span></div>
                        </div>
                    </div>

                    <div class="dashboard-card md:col-span-2 dashboard-full-span border-l-4 border-green-500"> 
                        <h3 class="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</h3>
                        <div class="analysis-box bg-gray-50 p-4 rounded-md">
                            <p id="summary-analysis" class="text-gray-700 whitespace-pre-wrap text-base leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="btn-download" class="w-full bg-purple-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-purple-600 transition duration-300 text-lg mt-6">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° üì•</button>
            <button id="btn-reset" class="w-full bg-red-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-red-600 transition duration-300 text-lg mt-4">ü§Ø ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å)</button>
        </div>

        <footer class="text-center p-4 mt-8 bg-white rounded-2xl shadow-lg">
            <p class="text-sm text-gray-600">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢: ‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏ô‡∏ó‡∏£ ‡∏â‡∏≠‡∏°‡πÑ‡∏ò‡∏™‡∏á (‡πÅ‡∏•‡∏∞ AI Gemini ü§ñ)</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. DOM Elements ---
            const pages = {
                'page-1': document.getElementById('page-1'),
                'page-2': document.getElementById('page-2'),
                'page-3': document.getElementById('page-3')
            };
            const stepIndicators = {
                'page-1': document.getElementById('step-1-indicator'),
                'page-2': document.getElementById('step-2-indicator'),
                'page-3': document.getElementById('step-3-indicator')
            };
            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            const infoForm = document.getElementById('info-form');
            const studentNameInput = document.getElementById('student-name');
            const studentClassInput = document.getElementById('student-class');
            const studentNumberInput = document.getElementById('student-number');
            
            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
            const worksheetForm = document.getElementById('worksheet-form');
            const studentSubjectInput = document.getElementById('student-subject'); 
            const ansAnalysisInput = document.getElementById('ans-analysis'); // ‚≠êÔ∏è ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ (Summary)
            const btnDownload = document.getElementById('btn-download');
            const btnReset = document.getElementById('btn-reset');
            const summaryName = document.getElementById('summary-name');
            const summaryClassNum = document.getElementById('summary-class-num'); // ‡∏£‡∏ß‡∏°‡∏ä‡∏±‡πâ‡∏ô/‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
            const summarySubject = document.getElementById('summary-subject'); 
            const summaryAnalysis = document.getElementById('summary-analysis'); // ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            
            const confettiElement = document.getElementById('confetti-canvas');
            let confettiInstance = null;

            // --- 2. Page Navigation ---
            function showPage(pageId) {
                Object.values(pages).forEach(page => page.classList.remove('active'));
                if (pages[pageId]) {
                    pages[pageId].classList.add('active');
                }
                Object.values(stepIndicators).forEach(indicator => {
                    indicator.classList.remove('bg-purple-500', 'text-white');
                    indicator.classList.add('bg-gray-200', 'text-gray-700');
                });
                if (stepIndicators[pageId]) {
                    stepIndicators[pageId].classList.add('bg-purple-500', 'text-white');
                    stepIndicators[pageId].classList.remove('bg-gray-200', 'text-gray-700');
                }
                
                // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á Confetti (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
                if (confettiInstance) {
                    confettiInstance.clear();
                }

                sessionStorage.setItem('currentPage', pageId);
                window.scrollTo(0, 0);
            }

            // --- 3. Data Loading ---
            function loadDataFromSession() {
                studentNameInput.value = sessionStorage.getItem('studentName') || '';
                studentClassInput.value = sessionStorage.getItem('studentClass') || '';
                studentNumberInput.value = sessionStorage.getItem('studentNumber') || '';
                studentSubjectInput.value = sessionStorage.getItem('studentSubject') || ''; 
                ansAnalysisInput.value = sessionStorage.getItem('answerAnalysis') || ''; 
            }

            // --- 4. Populate Summary (Page 3) (‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏≠‡∏Å) ---
            function populateSummary() {
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                const name = sessionStorage.getItem('studentName') || 'N/A';
                const sClass = sessionStorage.getItem('studentClass') || 'N/A';
                const sNumber = sessionStorage.getItem('studentNumber') || 'N/A';
                const sSubject = sessionStorage.getItem('studentSubject') || '(‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)'; 
                const sAnalysis = sessionStorage.getItem('answerAnalysis') || '(‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå)';

                summaryName.textContent = name;
                summaryClassNum.textContent = `${sClass} / ${sNumber}`;
                summarySubject.textContent = sSubject;
                summaryAnalysis.textContent = sAnalysis;

                // ‡∏•‡∏ö Logic ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞ Answer Key ‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            }

            // --- 5. Event Listeners ---
            infoForm.addEventListener('submit', (e) => {
                e.preventDefault();
                sessionStorage.setItem('studentName', studentNameInput.value);
                sessionStorage.setItem('studentClass', studentClassInput.value);
                sessionStorage.setItem('studentNumber', studentNumberInput.value);
                showPage('page-2');
            });
            worksheetForm.addEventListener('submit', (e) => {
                e.preventDefault(); 
                sessionStorage.setItem('studentSubject', studentSubjectInput.value);
                sessionStorage.setItem('answerAnalysis', ansAnalysisInput.value); // ‚≠êÔ∏è ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                                
                populateSummary(); 
                showPage('page-3'); 
            });
            btnDownload.addEventListener('click', () => {
                btnDownload.disabled = true;
                btnDownload.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•... ‚åõ';
                captureAndDownloadWithWatermark();
            });
            btnReset.addEventListener('click', () => {
                if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')) {
                    sessionStorage.clear();
                    location.reload();
                }
            });

            // --- 6. html2canvas + Watermark Logic (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°) ---
            async function captureAndDownloadWithWatermark() {
                const elementToCapture = document.getElementById('summary-content');

                elementToCapture.classList.add('ready-for-capture');

                try {
                    const canvas = await html2canvas(elementToCapture, {
                        scale: 1, 
                        useCORS: true,
                        backgroundColor: '#ffffff' 
                    });

                    elementToCapture.classList.remove('ready-for-capture');

                    // ‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥
                    const ctx = canvas.getContext('2d');
                    const name = sessionStorage.getItem('studentName') || '';
                    const sClass = sessionStorage.getItem('studentClass') || '';
                    const sNumber = sessionStorage.getItem('studentNumber') || '';
                    const watermarkText = `${name} ${sClass} ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${sNumber}`;

                    const fontSize = 60; 
                    ctx.font = `bold ${fontSize}px Sarabun, sans-serif`;
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle'; 

                    ctx.save();
                    ctx.translate(canvas.width / 2, canvas.height / 2);
                    ctx.rotate(-45 * Math.PI / 180); 
                    ctx.fillText(watermarkText, 0, 0);
                    ctx.restore();
                    
                    const image = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = `‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°_‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏•‡∏Å_${name.replace(/\s/g, '_')}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    btnDownload.disabled = false;
                    btnDownload.textContent = '‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° üì•';

                } catch (error) {
                    elementToCapture.classList.remove('ready-for-capture');
                    btnDownload.disabled = false;
                    btnDownload.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ‚ö†Ô∏è';
                    console.error('Download error:', error);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                }
            }

            // Initialize
            loadDataFromSession();
            const storedPage = sessionStorage.getItem('currentPage') || 'page-1';
            showPage(storedPage);
        });
    </script>
</body>
</html>
